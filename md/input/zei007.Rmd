---
always_allow_html: yes
output:
  html_document:
    css: ../../css/ccze.css
params:
  data.directory: "../../data/input/manual"
  data.collection: !r tolower(c("industry_total_sa_nace2.xlsx"))
  data.params: !r c("INDUSTRY MONTHLY")
  data.template: !r c("bdf.manual.xlsx")
  lang: "FR"
  numpage: 13
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::read_chunk("../../R/tool.R")
knitr::read_chunk("../../R/data.R")
knitr::read_chunk("../../R/ccze_init_table.R")
```
```{r}
<<init>>
<<tool>>
<<data>>
```

```{r}
htmltools::h3(class="pub",ifelse(params$lang=="FR","Activité : indicateur de confiance dans l'industrie","Activity: industrial confidence indicator"))
htmltools::hr(class="pub")
htmltools::p(class="unitlegend",ifelse(params$lang=="FR","solde des opinions","balance of opinions"))
```

```{r}

#get data & metadata
data.collection <- getDataCollection()
data.0 <- getData(data.collection,"industry_total_sa_nace2.xlsx")
meta <- data.0[[1]] #metadata
data.0 <- data.0[[2]] #data

#select series
series <- c(1, #variable
            2, #France
            3, #Germany
            4, #Austria
            5, #Belgium
            6, #Cyprus
            7, #Spain
            8, #Estonia
            9, #Finland
            10, #Greece
            11, #Ireland
            12, #Italy
            13, #Latvia
            14, #Lithuania
            15, #Luxembourg,
            16, #Malta
            17, #Netherlands
            18, #Portugal
            19, #Slovakia
            20, #Slovenia
            21, #Euro area
            22, #Bulgaria
            23, #Croatia
            24, #Denmark
            25, #Hungary
            26, #Poland
            27, #Romania
            28, #United Kingdom
            29, #Sweden
            30, #Czech Republic
            31) #European union

data <- t(data.0[,series])

#set metadata:
met <- tail(meta[series],-1)
met <- getCountryByCode(met)

#generate datatable:

#header:

cols <- zoo::as.yearmon(as.character(data[1,]),"%Y-%m")
t<-as.character(data[1,])
style.sep <- ""

sketch = htmltools::withTags(table(
  thead(
    tr(
      th(colspan=1,rowspan=2),
      getTH(base::table(as.character(format(cols,"%Y"))),"Y")
    ),
    tr(
      getTH(as.character(format(cols,"%b")),"M")
    )
  )
))

rm(list=ls(pattern="style\\.(sep|fwn|fwb)|t\\.|col\\.")) #clean-up

#end header

#data
t1 <- genDataTable(as.data.frame(data),met,sketch,c("France","Zone euro","Union européenne"))

#ouput the table
t1

```

<p>&nbsp;</p>

```{r}

#generate footer:

footer <- htmltools::withTags(
  list(
    p(style="text-align: left;",
      ifelse(params$lang=="FR",
             "Source : Commission européenne",
             "Source: European Commission"),
      span(style="float:right;",
           paste0(ifelse(params$lang=="FR",
                         "Réalisé le ",
                         "Produced on "),
                  format(Sys.Date(),"%e %B %Y"))))
  )
)

footer <- setFooter(footer)

#output footer:
footer

```


